<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>save4trade database</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Helvetica Neue', Arial, sans-serif;
            background: #fafafa;
            padding: 20px;
            font-weight: 300;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border: 1px solid #e0e0e0;
            box-shadow: 0 1px 3px rgba(0,0,0,0.06);
        }

        .header {
            background: #1a1a1a;
            color: white;
            padding: 24px 32px;
            border-bottom: 1px solid #333;
        }

        .header h1 {
            font-size: 1.5em;
            font-weight: 300;
            margin-bottom: 6px;
            letter-spacing: 0.5px;
        }

        .header p {
            font-size: 0.85em;
            opacity: 0.7;
            font-weight: 300;
        }

        .kofi-container {
            margin-top: 14px;
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .kofi-container a {
            display: inline-block;
            opacity: 0.9;
            transition: opacity 0.2s;
        }

        .kofi-container a:hover {
            opacity: 1;
        }

        .kofi-container img {
            height: 37px;
            width: 185px;
        }

        .language-selector {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-top: -3px;
        }

        .language-selector::before {
            content: "üåê";
            font-size: 1.2em;
            opacity: 0.9;
        }

        .language-selector select {
            padding: 8px 32px 8px 12px;
            border: 1px solid #666;
            background: #2a2a2a;
            color: white;
            font-size: 0.9em;
            cursor: pointer;
            border-radius: 4px;
            font-weight: 400;
            appearance: none;
            -webkit-appearance: none;
            -moz-appearance: none;
            background-image: url('data:image/svg+xml;charset=UTF-8,%3csvg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"%3e%3cpolyline points="6 9 12 15 18 9"%3e%3c/polyline%3e%3c/svg%3e');
            background-repeat: no-repeat;
            background-position: right 8px center;
            background-size: 16px;
            transition: all 0.2s;
        }

        .language-selector select:hover {
            background-color: #3a3a3a;
            border-color: #888;
        }

        .language-selector select:focus {
            outline: none;
            border-color: #999;
            box-shadow: 0 0 0 2px rgba(255, 255, 255, 0.1);
        }

        .language-selector select option {
            padding: 8px 12px;
            background: #2a2a2a;
            color: white;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 0;
            border-bottom: 1px solid #e0e0e0;
        }

        .stat-card {
            padding: 12px 20px;
            text-align: center;
            border-right: 1px solid #e0e0e0;
        }

        .stat-card:last-child {
            border-right: none;
        }

        .stat-card .number {
            font-size: 2em;
            font-weight: 300;
            color: #1a1a1a;
        }

        .stat-card .label {
            color: #999;
            margin-top: 4px;
            font-size: 0.75em;
            font-weight: 400;
            letter-spacing: 0.5px;
        }

        .xmlDownloadLink {
            color: #1a1a1a;
            font-size: 1.4em;
            font-weight: 400;
            text-decoration-line: none;
            cursor: pointer;
            display: inline-block;
            transition: transform 0.2s, color 0.2s;
            line-height: 1;
        }

        .xmlDownloadLink:hover {
            color: #0066cc;
            transform: scale(1.15);
        }

        .controls {
            padding: 16px 24px;
            background: #fafafa;
            border-bottom: 1px solid #e0e0e0;
        }

        .filter-group {
            display: flex;
            gap: 12px;
            flex-wrap: wrap;
            align-items: center;
        }

        .filter-group label {
            font-weight: 400;
            color: #666;
            font-size: 0.85em;
        }

        .filter-group select,
        .filter-group input {
            padding: 6px 12px;
            border: 1px solid #ddd;
            font-size: 0.85em;
            font-family: inherit;
            font-weight: 300;
            background: white;
        }

        .filter-group select:focus,
        .filter-group input:focus {
            outline: none;
            border-color: #1a1a1a;
        }

        .btn {
            background: white;
            color: #1a1a1a;
            border: 1px solid #1a1a1a;
            padding: 6px 16px;
            cursor: pointer;
            font-size: 0.85em;
            font-weight: 400;
            font-family: inherit;
            transition: all 0.2s;
        }

        .btn:hover {
            background: #1a1a1a;
            color: white;
        }

        .btn.active {
            background: #1a1a1a;
            color: white;
        }

        .btn:disabled,
        select:disabled,
        input:disabled {
            opacity: 0.4;
            cursor: not-allowed;
            pointer-events: none;
        }

        .table-container {
            padding: 24px;
            overflow-x: auto;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            table-layout: fixed;
        }

        th {
            background: #fafafa;
            padding: 10px 12px;
            text-align: left;
            font-weight: bold;
            color: #000000;
            border-bottom: 1px solid #e0e0e0;
            font-size: 0.8em;
            position: sticky;
            top: 0;
            z-index: 10;
        }

        th.sortable {
            cursor: pointer;
            user-select: none;
            transition: background 0.2s;
        }

        th.sortable:hover {
            background: #efefef;
        }

        th.sortable::after {
            content: " ‚áÖ";
            opacity: 0.3;
            font-size: 0.9em;
        }

        th.sortable.sorted-asc::after {
            content: " ‚ñ≤";
            opacity: 1;
            color: #1a1a1a;
        }

        th.sortable.sorted-desc::after {
            content: " ‚ñº";
            opacity: 1;
            color: #1a1a1a;
        }

        th.col-account {
            width: 70px;
            max-width: 70px;
        }

        th.col-time {
            width: 80px;
            max-width: 80px;
            font-size: 0.8em;
        }

        th.col-pack {
            width: 110px;
        }

        th.col-xml {
            width: 65px;
            max-width: 65px;
        }

        th.col-cards {
            width: 60px;
            max-width: 60px;
        }

        th.col-screenshot {
            width: 120px;
            max-width: 120px;
            font-size: 0.8em;
        }

        th.col-shinedust {
            width: 70px;
            max-width: 70px;
            font-size: 0.8em;
        }

        th.col-subTime {
            width: 80px;
            max-width: 80px;
            font-size: 0.8em;
        }

        .expandable {
            cursor: pointer;
            transition: background 0.2s;
        }

        .expandable:hover {
            background: #f5f5f5;
        }

        .expandable.expanded {
            background: #e8f4f8;
            border-left: 3px solid #4a90e2;
        }

        .detail-row {
            background: #fafafa;
            border-bottom: 1px solid #e0e0e0;
            border-left: 3px solid #4a90e2;
        }

        .detail-row.last-detail-row {
            border-bottom: 3px solid #4a90e2;
            margin-bottom: 4px;
        }

        .detail-row td {
            font-size: 0.75em;
            color: #666;
            padding: 8px 12px;
        }

        td {
            padding: 8px 12px;
            border-bottom: 1px solid #e0e0e0;
            font-size: 0.85em;
        }

        .summary-stats {
            display: flex;
            gap: 4px;
            flex-wrap: wrap;
        }

        .summary-badge {
            display: inline-block;
        }

        .badge {
            display: inline-block;
            padding: 4px 10px;
            font-size: 0.9em;
            font-weight: 400;
            margin: 2px;
            border: 1px solid;
        }

        .badge-pack {
            background: #f0f0f0;
            color: #1a1a1a;
            border-color: #ddd;
            font-size: 0.95em;
        }

        .badge-card {
            background: white;
            color: #1a1a1a;
            border-color: #999;
            font-size: 0.9em;
        }

        /* Card type specific colors */
        .card-crown {
            color: #B8860B;
            font-weight: 500;
        }

        .card-diamond {
            color: #4A7BA7;
            font-weight: 500;
        }

        .card-rainbow {
            background: linear-gradient(90deg, 
                #E74C3C 0%, 
                #E67E22 20%, 
                #F39C12 40%, 
                #27AE60 60%, 
                #3498DB 80%, 
                #9B59B6 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            font-weight: 600;
        }

        .card-shiny {
            color: #8B9197;
            font-weight: 500;
            text-shadow: 0 0 1px rgba(255, 255, 255, 0.8);
        }

        .card-immersive {
            background: linear-gradient(135deg, #1a1a1a 0%, #4A148C 30%, #880E4F 60%, #1A237E 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            font-weight: 600;
        }

        .card-fullart {
            color: #8E6BA8;
            font-weight: 500;
        }

        .card-trainer {
            color: #D17A70;
            font-weight: 500;
        }

        .card-star {
            color: #DAA520;
        }

        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #999;
            font-weight: 300;
        }

        .empty-state h2 {
            margin-bottom: 8px;
            font-weight: 300;
        }

        #fileInput {
            display: none;
        }
        
        .export-btn {
            background: #1a1a1a;
            color: white;
        }

        .export-btn:hover {
            background: #333;
        }

        .device-account {
            width: 80px;
            max-width: 80px;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Helvetica Neue', Arial, sans-serif;
            font-size: 0.8em;
            color: #000000;
            font-weight: 300;
        }

        .detail-screenshot {
            width: 120px;
            max-width: 120px;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Helvetica Neue', Arial, sans-serif;
            font-size: 0.75em;
            color: #000000;
            font-weight: 300;
        }

        .time-cell {
            width: 130px;
            font-size: 0.7em;
            color: #999;
        }

        .expand-icon {
            display: inline-block;
            width: 16px;
            text-align: center;
            margin-right: 8px;
            color: #666;
            font-size: 0.9em;
        }

        .expand-icon.expanded {
            transform: rotate(0deg);
        }

        .PackScreenshot {
            max-width: 110px;
            max-height: 80px;
            cursor: pointer;
            border: 1px solid #ddd;
            transition: transform 0.2s;
        }

        .PackScreenshot:hover {
            transform: scale(1.05);
        }

        .popup-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            z-index: 9999;
            justify-content: center;
            align-items: center;
        }

        .popup-content {
            max-width: 90%;
            max-height: 90%;
            text-align: center;
        }

        .popup-content img {
            max-width: 100%;
            max-height: 80vh;
            object-fit: contain;
        }

        .close-btn {
            display: block;
            margin: 20px auto 0;
            padding: 10px 30px;
            background: white;
            color: #1a1a1a;
            border: none;
            cursor: pointer;
            font-size: 1em;
            font-weight: 500;
            transition: all 0.2s;
        }

        .close-btn:hover {
            background: #f0f0f0;
        }

        .shinedust-high {
            color: #00cc00;
            font-weight: 500;
        }

        .shinedust-low {
            color: #cc0000;
            font-weight: 500;
        }

        .col-xml {
            font-size: 0.7em;
        }

    </style>
    <script>
        // Translation dictionary
        const translations = {
            en: {
                uniqueAccounts: "unique accounts",
                totalCards: "total cards",
                loadCSV: "load csv",
                allPacks: "all packs",
                allCards: "all cards",
                searchPlaceholder: "search account...",
                exportBtn: "export",
                deviceAccount: "deviceAccount",
                pack: "pack",
                cards: "cards",
                xml: ".xml",
                shinedust: "shinedust",
                screenshot: "screenshot",
                date: "date",
                noData: "no data loaded",
                clickLoad: "click load csv to view database",
                noResults: "no results",
                tryFilters: "try different filters",
                // Pack names
                megagyarados: "Mega Gyarados",
                megablaziken: "Mega Blaziken",
                megaaltaria: "Mega Altaria",
                deluxe: "Deluxe",
                springs: "Springs",
                hooh: "Ho-Oh",
                lugia: "Lugia",
                eevee: "Eevee",
                buzzwole: "Extradimensional Crisis",
                solgaleo: "Solgaleo",
                lunala: "Lunala",
                shining: "Shining",
                arceus: "Arceus",
                palkia: "Palkia",
                dialga: "Dialga",
                pikachu: "Pikachu",
                charizard: "Charizard",
                mewtwo: "Mewtwo",
                mew: "Mew",
                // Card types
                crown: "Crown",
                fullart: "Full Art",
                trainer: "Trainer",
                rainbow: "Rainbow",
                shiny1star: "Shiny",
                shiny2star: "Shiny",
                immersive: "Immersive",
                "4diamond": "‚óÜ‚óÜ‚óÜ‚óÜ"
            },
            zh: {
                uniqueAccounts: "Áã¨ÁâπÂ∏êÊà∑",
                totalCards: "ÊÄªÂç°Êï∞",
                loadCSV: "Âä†ËΩΩ csv",
                allPacks: "ÊâÄÊúâÂç°ÂåÖ",
                allCards: "ÊâÄÊúâÂç°Áâå",
                searchPlaceholder: "ÊêúÁ¥¢Â∏êÊà∑...",
                exportBtn: "ÂØºÂá∫",
                deviceAccount: "ËÆæÂ§áÂ∏êÊà∑",
                pack: "Âç°ÂåÖ",
                cards: "Âç°Áâå",
                xml: ".xml",
                shinedust: "Èó™ÂÖâÂ∞ò",
                screenshot: "Êà™Âõæ",
                date: "Êó•Êúü",
                noData: "Êú™Âä†ËΩΩÊï∞ÊçÆ",
                clickLoad: "ÁÇπÂáªÂä†ËΩΩ csv Êü•ÁúãÊï∞ÊçÆÂ∫ì",
                noResults: "Êó†ÁªìÊûú",
                tryFilters: "Â∞ùËØï‰∏çÂêåÁöÑÁ≠õÈÄâÂô®",
                // Pack names
                megagyarados: "Ë∂ÖÁ¥öÊö¥ÈØâÈæç",
                megablaziken: "Ë∂ÖÁ¥öÁÅ´ÁÑ∞Èõû",
                megaaltaria: "Ë∂ÖÁ¥ö‰∏ÉÂ§ïÈùíÈ≥•",
                deluxe: "Ë±™ËèØ",
                springs: "Ê∫´Ê≥â",
                hooh: "È≥≥Áéã",
                lugia: "Ê¥õÂ•á‰∫û",
                eevee: "‰ºäÂ∏É",
                buzzwole: "Áï∞Ê¨°ÂÖÉÂç±Ê©ü",
                solgaleo: "Á¥¢ÁàæËø¶Èõ∑Ê≠ê",
                lunala: "Èú≤Â•àÈõÖÊãâ",
                shining: "ÈñÉËÄÄ",
                arceus: "ÈòøÁàæÂÆôÊñØ",
                palkia: "Â∏ïË∑ØÂ•á‰∫û",
                dialga: "Â∏ùÁâôÁõßÂç°",
                pikachu: "ÁöÆÂç°‰∏ò",
                charizard: "Âô¥ÁÅ´Èæç",
                mewtwo: "Ë∂ÖÂ§¢",
                mew: "Â§¢Âπª",
                // Card types
                crown: "ÁéãÂÜ†",
                fullart: "ÂÖ®ÊÅØ",
                trainer: "ËÆ≠ÁªÉÂÆ∂",
                rainbow: "ÂΩ©Ëôπ",
                shiny1star: "Èó™Âç°",
                shiny2star: "Èó™Âç°",
                immersive: "Ê≤âÊµ∏Âºè",
                "4diamond": "‚óÜ‚óÜ‚óÜ‚óÜ"
            },
            ja: {
                uniqueAccounts: "Âõ∫Êúâ„Ç¢„Ç´„Ç¶„É≥„Éà",
                totalCards: "ÂêàË®à„Ç´„Éº„ÉâÊï∞",
                loadCSV: "csvË™≠„ÅøËæº„Åø",
                allPacks: "„Åô„Åπ„Å¶„ÅÆ„Éë„ÉÉ„ÇØ",
                allCards: "„Åô„Åπ„Å¶„ÅÆ„Ç´„Éº„Éâ",
                searchPlaceholder: "„Ç¢„Ç´„Ç¶„É≥„ÉàÊ§úÁ¥¢...",
                exportBtn: "„Ç®„ÇØ„Çπ„Éù„Éº„Éà",
                deviceAccount: "„Éá„Éê„Ç§„Çπ„Ç¢„Ç´„Ç¶„É≥„Éà",
                pack: "„Éë„ÉÉ„ÇØ",
                cards: "„Ç´„Éº„Éâ",
                xml: ".xml",
                shinedust: "„Ç∑„É£„Ç§„É≥„ÉÄ„Çπ„Éà",
                screenshot: "„Çπ„ÇØ„É™„Éº„É≥„Ç∑„Éß„ÉÉ„Éà",
                date: "Êó•‰ªò",
                noData: "„Éá„Éº„Çø„ÅåË™≠„ÅøËæº„Åæ„Çå„Å¶„ÅÑ„Åæ„Åõ„Çì",
                clickLoad: "csv„ÇíË™≠„ÅøËæº„Çì„Åß„Éá„Éº„Çø„Éô„Éº„Çπ„ÇíË°®Á§∫",
                noResults: "ÁµêÊûú„Å™„Åó",
                tryFilters: "Âà•„ÅÆ„Éï„Ç£„É´„Çø„Éº„ÇíË©¶„Åô",
                // Pack names
                megagyarados: "„É°„Ç¨„ÇÆ„É£„É©„Éâ„Çπ",
                megablaziken: "„É°„Ç¨„Éê„Ç∑„É£„Éº„É¢",
                megaaltaria: "„É°„Ç¨„ÉÅ„É´„Çø„É™„Çπ",
                deluxe: "„Éá„É©„ÉÉ„ÇØ„Çπ",
                springs: "Ê∏©Ê≥â",
                hooh: "„Éõ„Ç¶„Ç™„Ç¶",
                lugia: "„É´„ÇÆ„Ç¢",
                eevee: "„Ç§„Éº„Éñ„Ç§",
                buzzwole: "Áï∞Ê¨°ÂÖÉ„ÅÆÂç±Ê©ü",
                solgaleo: "„ÇΩ„É´„Ç¨„É¨„Ç™",
                lunala: "„É´„Éä„Ç¢„Éº„É©",
                shining: "„Ç∑„É£„Ç§„Éã„É≥„Ç∞",
                arceus: "„Ç¢„É´„Çª„Ç¶„Çπ",
                palkia: "„Éë„É´„Ç≠„Ç¢",
                dialga: "„Éá„Ç£„Ç¢„É´„Ç¨",
                pikachu: "„Éî„Ç´„ÉÅ„É•„Ç¶",
                charizard: "„É™„Ç∂„Éº„Éâ„É≥",
                mewtwo: "„Éü„É•„Ç¶„ÉÑ„Éº",
                mew: "„Éü„É•„Ç¶",
                // Card types
                crown: "„ÇØ„É©„Ç¶„É≥",
                fullart: "„Éï„É´„Ç¢„Éº„Éà",
                trainer: "„Éà„É¨„Éº„Éä„Éº",
                rainbow: "„É¨„Ç§„É≥„Éú„Éº",
                shiny1star: "„Ç∑„É£„Ç§„Éã„Éº",
                shiny2star: "„Ç∑„É£„Ç§„Éã„Éº",
                immersive: "„Ç§„Éû„Éº„Ç∑„Éñ",
                "4diamond": "‚óÜ‚óÜ‚óÜ‚óÜ"
            },
            de: {
                uniqueAccounts: "eindeutige Konten",
                totalCards: "Gesamtkarten",
                loadCSV: "csv laden",
                allPacks: "alle Packs",
                allCards: "alle Karten",
                searchPlaceholder: "Konto suchen...",
                exportBtn: "exportieren",
                deviceAccount: "Ger√§tekonto",
                pack: "Pack",
                cards: "Karten",
                xml: ".xml",
                shinedust: "Glitzerstaub",
                screenshot: "Screenshot",
                date: "Datum",
                noData: "keine Daten geladen",
                clickLoad: "csv laden, um Datenbank anzuzeigen",
                noResults: "keine Ergebnisse",
                tryFilters: "andere Filter versuchen",
                // Pack names
                megagyarados: "Mega-Garados",
                megablaziken: "Mega-Lohgock",
                megaaltaria: "Mega-Altaria",
                deluxe: "Deluxe",
                springs: "Quellen",
                hooh: "Ho-Oh",
                lugia: "Lugia",
                eevee: "Evoli",
                buzzwole: "Interdimensionale Krise",
                solgaleo: "Solgaleo",
                lunala: "Lunala",
                shining: "Gl√§nzend",
                arceus: "Arceus",
                palkia: "Palkia",
                dialga: "Dialga",
                pikachu: "Pikachu",
                charizard: "Glurak",
                mewtwo: "Mewtu",
                mew: "Mew",
                // Card types
                crown: "Krone",
                fullart: "Vollkunst",
                trainer: "Trainer",
                rainbow: "Regenbogen",
                shiny1star: "Gl√§nzend",
                shiny2star: "Gl√§nzend",
                immersive: "Immersiv",
                "4diamond": "‚óÜ‚óÜ‚óÜ‚óÜ"
            },
            fr: {
                uniqueAccounts: "comptes uniques",
                totalCards: "total de cartes",
                loadCSV: "charger csv",
                allPacks: "tous les paquets",
                allCards: "toutes les cartes",
                searchPlaceholder: "rechercher un compte...",
                exportBtn: "exporter",
                deviceAccount: "compte appareil",
                pack: "paquet",
                cards: "cartes",
                xml: ".xml",
                shinedust: "poussi√®re brillante",
                screenshot: "capture d'√©cran",
                date: "date",
                noData: "aucune donn√©e charg√©e",
                clickLoad: "cliquez sur charger csv pour voir la base de donn√©es",
                noResults: "aucun r√©sultat",
                tryFilters: "essayez diff√©rents filtres",
                // Pack names
                megagyarados: "M√©ga-L√©viator",
                megablaziken: "M√©ga-Bras√©gali",
                megaaltaria: "M√©ga-Altaria",
                deluxe: "Deluxe",
                springs: "Sources",
                hooh: "Ho-Oh",
                lugia: "Lugia",
                eevee: "√âvoli",
                buzzwole: "Crise Extradimensionnelle",
                solgaleo: "Solgaleo",
                lunala: "Lunala",
                shining: "Brillant",
                arceus: "Arceus",
                palkia: "Palkia",
                dialga: "Dialga",
                pikachu: "Pikachu",
                charizard: "Dracaufeu",
                mewtwo: "Mewtwo",
                mew: "Mew",
                // Card types
                crown: "Couronne",
                fullart: "Art Complet",
                trainer: "Dresseur",
                rainbow: "Arc-en-ciel",
                shiny1star: "Brillant",
                shiny2star: "Brillant",
                immersive: "Immersif",
                "4diamond": "‚óÜ‚óÜ‚óÜ‚óÜ"
            },
            ko: {
                uniqueAccounts: "Í≥†Ïú† Í≥ÑÏ†ï",
                totalCards: "Ï¥ù Ïπ¥Îìú",
                loadCSV: "csv Î°úÎìú",
                allPacks: "Î™®Îì† Ìå©",
                allCards: "Î™®Îì† Ïπ¥Îìú",
                searchPlaceholder: "Í≥ÑÏ†ï Í≤ÄÏÉâ...",
                exportBtn: "ÎÇ¥Î≥¥ÎÇ¥Í∏∞",
                deviceAccount: "Í∏∞Í∏∞ Í≥ÑÏ†ï",
                pack: "Ìå©",
                cards: "Ïπ¥Îìú",
                xml: ".xml",
                shinedust: "ÏÉ§Ïù∏ÎçîÏä§Ìä∏",
                screenshot: "Ïä§ÌÅ¨Î¶∞ÏÉ∑",
                date: "ÎÇ†Ïßú",
                noData: "Îç∞Ïù¥ÌÑ∞Í∞Ä Î°úÎìúÎêòÏßÄ ÏïäÏùå",
                clickLoad: "Îç∞Ïù¥ÌÑ∞Î≤†Ïù¥Ïä§Î•º Î≥¥Î†§Î©¥ csv Î°úÎìúÎ•º ÌÅ¥Î¶≠ÌïòÏÑ∏Ïöî",
                noResults: "Í≤∞Í≥º ÏóÜÏùå",
                tryFilters: "Îã§Î•∏ ÌïÑÌÑ∞Î•º ÏãúÎèÑÌïòÏÑ∏Ïöî",
                // Pack names
                megagyarados: "Î©îÍ∞ÄÍ∞∏ÎùºÎèÑÏä§",
                megablaziken: "Î©îÍ∞ÄÎ≤àÏπòÏΩî",
                megaaltaria: "Î©îÍ∞ÄÌååÎπÑÏΩîÎ¶¨",
                deluxe: "ÎîîÎü≠Ïä§",
                springs: "Ïò®Ï≤ú",
                hooh: "Ïπ†ÏÉâÏ°∞",
                lugia: "Î£®Í∏∞ÏïÑ",
                eevee: "Ïù¥Î∏åÏù¥",
                buzzwole: "Ïù¥Ï∞®Ïõê ÏúÑÍ∏∞",
                solgaleo: "ÏÜîÍ∞ÄÎ†àÏò§",
                lunala: "Î£®ÎÇòÏïÑÎùº",
                shining: "ÏÉ§Ïù¥Îãù",
                arceus: "ÏïÑÎ•¥ÏÑ∏Ïö∞Ïä§",
                palkia: "ÌéÑÍ∏∞ÏïÑ",
                dialga: "ÎîîÏïÑÎ£®Í∞Ä",
                pikachu: "ÌîºÏπ¥Ï∏Ñ",
                charizard: "Î¶¨ÏûêÎ™Ω",
                mewtwo: "ÎÆ§Ï∏†",
                mew: "ÎÆ§",
                // Card types
                crown: "ÌÅ¨ÎùºÏö¥",
                fullart: "ÌíÄÏïÑÌä∏",
                trainer: "Ìä∏Î†àÏù¥ÎÑà",
                rainbow: "Î†àÏù∏Î≥¥Ïö∞",
                shiny1star: "ÏÉ§Ïù¥Îãà",
                shiny2star: "ÏÉ§Ïù¥Îãà",
                immersive: "Ïù¥Î®∏ÏãúÎ∏å",
                "4diamond": "‚óÜ‚óÜ‚óÜ‚óÜ"
            },
            es: {
                uniqueAccounts: "cuentas √∫nicas",
                totalCards: "total de cartas",
                loadCSV: "cargar csv",
                allPacks: "todos los sobres",
                allCards: "todas las cartas",
                searchPlaceholder: "buscar cuenta...",
                exportBtn: "exportar",
                deviceAccount: "cuenta dispositivo",
                pack: "sobre",
                cards: "cartas",
                xml: ".xml",
                shinedust: "polvo brillante",
                screenshot: "captura de pantalla",
                date: "fecha",
                noData: "no hay datos cargados",
                clickLoad: "haga clic en cargar csv para ver la base de datos",
                noResults: "sin resultados",
                tryFilters: "pruebe diferentes filtros",
                // Pack names
                megagyarados: "Mega Gyarados",
                megablaziken: "Mega Blaziken",
                megaaltaria: "Mega Altaria",
                deluxe: "Deluxe",
                springs: "Fuentes",
                hooh: "Ho-Oh",
                lugia: "Lugia",
                eevee: "Eevee",
                buzzwole: "Crisis Extradimensional",
                solgaleo: "Solgaleo",
                lunala: "Lunala",
                shining: "Brillante",
                arceus: "Arceus",
                palkia: "Palkia",
                dialga: "Dialga",
                pikachu: "Pikachu",
                charizard: "Charizard",
                mewtwo: "Mewtwo",
                mew: "Mew",
                // Card types
                crown: "Corona",
                fullart: "Arte Completo",
                trainer: "Entrenador",
                rainbow: "Arco√≠ris",
                shiny1star: "Brillante",
                shiny2star: "Brillante",
                immersive: "Inmersivo",
                "4diamond": "‚óÜ‚óÜ‚óÜ‚óÜ"
            }
        };

        let currentLanguage = 'en';
        let allData = [];
        let filteredData = [];
        let expandedAccounts = new Set();
        let csvLoaded = false;
        let sortColumn = null;
        let sortDirection = 'desc'; // 'asc' or 'desc'

        function changeLanguage() {
            const select = document.getElementById('languageSelect');
            currentLanguage = select.value;
            
            updateUIText();
            if (csvLoaded) {
                populateFilters();
                renderTable();
            }
        }

        function updateUIText() {
            const t = translations[currentLanguage];
            
            // Update stats labels
            document.querySelector('#uniqueAccounts').nextElementSibling.textContent = t.uniqueAccounts;
            document.querySelector('#totalCards').nextElementSibling.textContent = t.totalCards;
            
            // Update table headers
            const headerElements = document.querySelectorAll('[data-i18n]');
            headerElements.forEach(el => {
                const key = el.getAttribute('data-i18n');
                if (t[key]) {
                    el.textContent = t[key];
                }
            });
            
            // Update button if visible
            const loadBtn = document.getElementById('loadCSVBtn');
            if (loadBtn && loadBtn.style.display !== 'none') {
                loadBtn.textContent = t.loadCSV;
            }
            
            // Update filter placeholders
            const packFilter = document.getElementById('packFilter');
            if (packFilter) {
                packFilter.options[0].textContent = t.allPacks;
            }
            
            const cardFilter = document.getElementById('cardFilter');
            if (cardFilter) {
                cardFilter.options[0].textContent = t.allCards;
            }
            
            document.getElementById('searchInput').placeholder = t.searchPlaceholder;
            document.getElementById('exportBtn').textContent = t.exportBtn;
            
            // Update empty state if visible
            const emptyState = document.querySelector('.empty-state');
            if (emptyState) {
                const h2 = emptyState.querySelector('h2');
                const p = emptyState.querySelector('p');
                if (h2 && p) {
                    if (!csvLoaded) {
                        h2.textContent = t.noData;
                        p.textContent = t.clickLoad;
                    } else {
                        h2.textContent = t.noResults;
                        p.textContent = t.tryFilters;
                    }
                }
            }
        }

        function translatePackType(packType) {
            if (!packType) return packType;
            const t = translations[currentLanguage];
            const key = packType.toLowerCase().replace(/[^a-z0-9]/g, '');
            return t[key] || packType;
        }

        function translateCardType(cardType) {
            if (!cardType) return cardType;
            const t = translations[currentLanguage];
            const key = cardType.toLowerCase().replace(/[^a-z0-9]/g, '');
            return t[key] || cardType;
        }

        function shortenDeviceAccount(account) {
            if (!account || account.length <= 6) return account;
            return account.substring(0, 5) + '..';
        }

        document.addEventListener('DOMContentLoaded', () => {
            const popup = document.getElementById('popup');
            const closeBtn = document.getElementById('closeBtn');

            closeBtn.addEventListener('click', () => {
                popup.style.display = 'none';
            });

            popup.addEventListener('click', e => {
                if (e.target === popup) popup.style.display = 'none';
            });

            document.addEventListener('keydown', e => {
                if (e.key === 'Escape') popup.style.display = 'none';
            });

            document.getElementById('fileInput').addEventListener('change', function(e) {
                const file = e.target.files[0];
                if (!file) return;

                const reader = new FileReader();
                reader.onload = function(event) {
                    parseCSV(event.target.result);
                };
                reader.readAsText(file);
            });
        });

        function parseCSV(csvText) {
            const lines = csvText.trim().split('\n');
            
            allData = [];
            
            for (let i = 1; i < lines.length; i++) {
                if (!lines[i].trim()) continue;
                
                const values = lines[i].split(',');
                const row = {
                    timestamp: values[0],
                    originalFilename: values[1],
                    cleanFilename: values[2],
                    deviceAccount: values[3],
                    packType: values[4],
                    cardTypes: values[5] ? values[5].split('|') : [],
                    cardCounts: values[6] ? values[6].split('|').map(Number) : [],
                    packScreenshot: values[7] ? values[7].trim() : '',
                    shinedust: values[8] ? values[8].trim() : '',
                };
                allData.push(row);
            }

            filteredData = [...allData];
            csvLoaded = true;
            enableControls();
            updateStats();
            populateFilters();
            renderTable();
        }

        function enableControls() {
            document.getElementById('packFilter').disabled = false;
            document.getElementById('cardFilter').disabled = false;
            document.getElementById('searchInput').disabled = false;
            document.getElementById('exportBtn').disabled = false;
            // Hide load CSV button
            document.getElementById('loadCSVBtn').style.display = 'none';
        }

        function updateStats() {
            const uniqueAccounts = new Set(allData.map(row => row.deviceAccount)).size;
            const totalCards = allData.reduce((sum, row) => 
                sum + row.cardCounts.reduce((a, b) => a + b, 0), 0
            );

            document.getElementById('uniqueAccounts').textContent = uniqueAccounts;
            document.getElementById('totalCards').textContent = totalCards;
        }

        function populateFilters() {
            const packTypes = new Set(allData.map(row => row.packType));
            const cardTypes = new Map();
            allData.forEach(row => {
                row.cardTypes.forEach((type, idx) => {
                    const count = row.cardCounts[idx] || 0;
                    cardTypes.set(type, (cardTypes.get(type) || 0) + count);
                });
            });

            const t = translations[currentLanguage];
            const packFilter = document.getElementById('packFilter');
            packFilter.innerHTML = `<option value="">${t.allPacks}</option>`;
            packTypes.forEach(pack => {
                const translatedPack = translatePackType(pack);
                packFilter.innerHTML += `<option value="${pack}">${translatedPack}</option>`;
            });

            const cardFilter = document.getElementById('cardFilter');
            cardFilter.innerHTML = `<option value="">${t.allCards}</option>`;
            cardTypes.forEach((count, card) => {
                cardFilter.innerHTML += `<option value="${card}">${getCardDisplayName(card)} (${count})</option>`;
            });

            packFilter.addEventListener('change', applyFilters);
            cardFilter.addEventListener('change', applyFilters);
            document.getElementById('searchInput').addEventListener('input', applyFilters);
        }

        function sortData(column) {
            if (sortColumn === column) {
                // Toggle direction if clicking same column
                sortDirection = sortDirection === 'asc' ? 'desc' : 'asc';
            } else {
                // New column, default to descending
                sortColumn = column;
                sortDirection = 'desc';
            }
            
            renderTable();
        }

        function applyFilters() {
            const packFilter = document.getElementById('packFilter').value;
            const cardFilter = document.getElementById('cardFilter').value;
            const searchText = document.getElementById('searchInput').value.toLowerCase();

            filteredData = allData.filter(row => {
                if (packFilter && row.packType !== packFilter) return false;
                if (cardFilter && !row.cardTypes.includes(cardFilter)) return false;
                if (searchText) {
                    const searchableText = (row.cleanFilename + row.deviceAccount + row.originalFilename).toLowerCase();
                    if (!searchableText.includes(searchText)) return false;
                }
                return true;
            });

            expandedAccounts.clear();
            renderTable();
        }

        function getCardDisplayName(cardType) {
            const type = cardType.toLowerCase();
            const translated = translateCardType(cardType);
            
            if (type === 'crown') return '<span class="card-star">üëë</span> <span class="card-crown">' + translated + '</span>';
            if (type === 'fullart') return '<span class="card-star">‚òÖ‚òÖ</span> <span class="card-fullart">' + translated + '</span>';
            if (type === 'trainer') return '<span class="card-star">‚òÖ‚òÖ</span> <span class="card-trainer">' + translated + '</span>';
            if (type === 'rainbow') return '<span class="card-star">‚òÖ‚òÖ</span> <span class="card-rainbow">' + translated + '</span>';
            if (type === 'shiny1star') return '<span class="card-star">‚òÖ</span> <span class="card-shiny">' + translated + '</span>';
            if (type === 'shiny2star') return '<span class="card-star">‚òÖ‚òÖ</span> <span class="card-shiny">' + translated + '</span>';
            if (type === 'immersive') return '<span class="card-immersive">' + translated + '</span>';
            if (type === '4diamond') return '<span class="card-diamond">‚óÜ‚óÜ‚óÜ‚óÜ</span>';
            return translated;
        }

        function aggregateByAccount(data) {
            const accountMap = new Map();
            
            data.forEach(row => {
                const key = row.deviceAccount;
                if (!accountMap.has(key)) {
                    accountMap.set(key, {
                        deviceAccount: row.deviceAccount,
                        firstSeen: row.timestamp,
                        lastSeen: row.timestamp,
                        totalPulls: 0,
                        packTypes: new Set(),
                        cards: new Map(),
                        details: []
                    });
                }
                
                const account = accountMap.get(key);
                account.totalPulls++;
                account.packTypes.add(row.packType);
                account.lastSeen = row.timestamp;
                account.details.push(row);
                
                row.cardTypes.forEach((cardType, idx) => {
                    const count = row.cardCounts[idx];
                    if (account.cards.has(cardType)) {
                        account.cards.set(cardType, account.cards.get(cardType) + count);
                    } else {
                        account.cards.set(cardType, count);
                    }
                });
            });
            
            return Array.from(accountMap.values());
        }

        function toggleAccount(deviceAccount) {
            if (expandedAccounts.has(deviceAccount)) {
                expandedAccounts.delete(deviceAccount);
            } else {
                expandedAccounts.add(deviceAccount);
            }
            renderTable();
        }

        function renderTable() {
            const t = translations[currentLanguage];
            const thead = document.getElementById('tableHead');
            const tbody = document.getElementById('tableBody');
            
            if (filteredData.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="7" class="empty-state">
                            <h2>${csvLoaded ? t.noResults : t.noData}</h2>
                            <p>${csvLoaded ? t.tryFilters : t.clickLoad}</p>
                        </td>
                    </tr>
                `;
                return;
            }

            const dateClass = sortColumn === 'date' ? `sorted-${sortDirection}` : '';
            const shinedustClass = sortColumn === 'shinedust' ? `sorted-${sortDirection}` : '';

            thead.innerHTML = `
                <tr>
                    <th class="col-account"><span data-i18n="deviceAccount">${t.deviceAccount}</span></th>
                    <th class="col-pack"><span data-i18n="pack">${t.pack}</span></th>
                    <th class="col-cards"><span data-i18n="cards">${t.cards}</span></th>
                    <th class="col-shinedust sortable ${shinedustClass}" onclick="sortData('shinedust')"><span data-i18n="shinedust">${t.shinedust}</span></th>
                    <th class="col-screenshot"><span data-i18n="screenshot">${t.screenshot}</span></th>
                    <th class="col-xml"><span data-i18n="xml">${t.xml}</span></th>
                    <th class="col-subTime sortable ${dateClass}" onclick="sortData('date')"><span data-i18n="date">${t.date}</span></th>
                </tr>
            `;

            let aggregated = aggregateByAccount(filteredData);
            
            // Apply sorting
            if (sortColumn === 'date') {
                aggregated.sort((a, b) => {
                    const dateA = new Date(a.lastSeen);
                    const dateB = new Date(b.lastSeen);
                    return sortDirection === 'asc' ? dateA - dateB : dateB - dateA;
                });
            } else if (sortColumn === 'shinedust') {
                aggregated.sort((a, b) => {
                    const shinedustA = a.details.length > 0 && a.details[a.details.length - 1].shinedust 
                        ? parseInt(a.details[a.details.length - 1].shinedust) 
                        : 0;
                    const shinedustB = b.details.length > 0 && b.details[b.details.length - 1].shinedust 
                        ? parseInt(b.details[b.details.length - 1].shinedust) 
                        : 0;
                    return sortDirection === 'asc' ? shinedustA - shinedustB : shinedustB - shinedustA;
                });
            }

            tbody.innerHTML = '';
            
            aggregated.forEach(account => {
                const tr = document.createElement('tr');
                const isExpanded = expandedAccounts.has(account.deviceAccount);
                tr.className = isExpanded ? 'expandable expanded' : 'expandable';
                
                const expandIcon = isExpanded ? '‚ñº' : '‚ñ∂';
                
                const cardsHTML = Array.from(account.cards.entries())
                    .map(([type, count]) => {
                        return `<span class="summary-badge"><span class="badge badge-card">${getCardDisplayName(type)} √ó${count}</span></span>`;
                    })
                    .join(' ');

                const packsHTML = Array.from(account.packTypes)
                    .filter(pack => pack && pack.length > 0)
                    .map(pack => `<span class="badge badge-pack">${translatePackType(pack)}</span>`)
                    .join(' ');

                const xmlFilenames = [...new Set(account.details.map(d => d.cleanFilename))].join(', ');
                const originalFileName = account.details.map(d => d.originalFilename).join(',');
                
                // Get latest shinedust value from most recent entry
                const latestShinedust = account.details.length > 0 && account.details[account.details.length - 1].shinedust 
                    ? account.details[account.details.length - 1].shinedust 
                    : '';

                const shinedust = latestShinedust !== '' ? parseInt(latestShinedust) : 0;
                const shinedustClass = shinedust >= 25000 ? 'shinedust-high' : (shinedust > 0 ? 'shinedust-low' : '');
                const shinedustHTML = latestShinedust !== '' ? `<span class="${shinedustClass}">${latestShinedust}</span>` : '';

                tr.innerHTML = `
                    <td class="device-account">
                        <span class="expand-icon ${isExpanded ? 'expanded' : ''}">${expandIcon}</span>
                        ${shortenDeviceAccount(account.deviceAccount)}
                    </td>
                    <td>${packsHTML}</td>
                    <td class="col-cards"><div class="summary-stats">${cardsHTML}</div></td>
                    <td class="col-shinedust">${shinedustHTML}</td>
                    <td class="col-screenshot"></td>
                    <td class="col-xml">${xmlFilenames}&nbsp;&nbsp;&nbsp;<span class="xmlDownloadLink" data-info="${originalFileName}">‚¨á</span></td>
                    <td class="time-cell">${account.lastSeen.split(' ')[0]}</td>
                `;
                
                tr.onclick = () => toggleAccount(account.deviceAccount);
                tbody.appendChild(tr);

                if (isExpanded) {
                    let detailRowHtml = '';
                    let screenshotTag = '';
                    const validDetails = account.details.filter(detail => 
                        !(detail.packType.length == 0 && detail.shinedust > 0)
                    );
                    
                    validDetails.forEach((detail, index) => {
                        const detailTr = document.createElement('tr');
                        const isLastDetail = index === validDetails.length - 1;
                        detailTr.className = isLastDetail ? 'detail-row last-detail-row' : 'detail-row';
                        
                        const detailCardsHTML = detail.cardTypes.map((type, idx) => {
                            return `<span class="badge badge-card">${getCardDisplayName(type)} √ó${detail.cardCounts[idx]}</span>`;
                        }).join(' ');

                        const screenshotFileName = detail.packScreenshot.replace(/\n/g, "");

                        detailRowHtml = `
                            <td class="device-account"></td>
                            <td><span class="badge badge-pack">${translatePackType(detail.packType)}</span></td>
                            <td class="col-cards">${detailCardsHTML}</td>
                            <td class="col-shinedust"></td>
                            <td class="detail-screenshot">
                        `;
                        screenshotTag = ``;
                        if(screenshotFileName.trim().length > 0){
                            screenshotTag = `<img class="PackScreenshot" src="../../Screenshots/Trades/${screenshotFileName}">`;
                        }
                        detailRowHtml += screenshotTag;
                        detailRowHtml += `
                            </td>
                            <td class="col-xml" title="${detail.originalFilename}">${detail.cleanFilename}</td>
                            <td class="time-cell">${detail.timestamp}</td>
                        `;
                        detailTr.innerHTML = detailRowHtml;
                        
                        tbody.appendChild(detailTr);
                    });
                }
            });

            document.querySelectorAll('.PackScreenshot').forEach(el => {
                el.addEventListener('click', openPopup);
            });
        }

        function openPopup(event) {
            event.stopPropagation();
            const imgObj = event.currentTarget;
            const popupImg = document.getElementById('popup-img');

            popupImg.src = imgObj.src;
            popup.style.display = 'flex';
        }

        function exportFiltered() {
            const t = translations[currentLanguage];
            if (filteredData.length === 0) {
                alert(t.noResults);
                return;
            }

            const headers = 'Timestamp,OriginalFilename,CleanFilename,DeviceAccount,PackType,CardTypes,CardCounts,PackScreenshot,Shinedust\n';
            const rows = filteredData.map(row => 
                `${row.timestamp},${row.originalFilename},${row.cleanFilename},${row.deviceAccount},${row.packType},${row.cardTypes.join('|')},${row.cardCounts.join('|')},${row.packScreenshot},${row.shinedust || ''}`
            ).join('\n');

            const csv = headers + rows;
            const blob = new Blob([csv], { type: 'text/csv' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `trades_export_${new Date().toISOString().slice(0, 10)}.csv`;
            a.click();
            window.URL.revokeObjectURL(url);
        }
    </script>
</head>
<body>    
    <div class="popup-overlay" id="popup">
        <div class="popup-content">
            <img id="popup-img" src="" alt="Enlarged Image">
            <br>
            <button class="close-btn" id="closeBtn">Close</button>
        </div>
    </div>
    <div class="container">
        <div class="header">
            <h1>save4trade database</h1>
            <p>for ptcgp bot (kevinnnn)</p>
            <div class="kofi-container">
                <a href="https://ko-fi.com/kevnitg" target="_blank" rel="noopener noreferrer">
                    <img src="../../GUI/images/support_me_on_kofi.png" alt="support me on ko-fi" />
                </a>
                <div class="language-selector">
                    <select id="languageSelect" onchange="changeLanguage()">
                        <option value="en">English</option>
                        <option value="zh">‰∏≠Êñá</option>
                        <option value="ja">Êó•Êú¨Ë™û</option>
                        <option value="ko">ÌïúÍµ≠Ïñ¥</option>
                        <option value="de">Deutsch</option>
                        <option value="fr">Fran√ßais</option>
                        <option value="es">Espa√±ol</option>
                    </select>
                </div>
            </div>
        </div>

        <div class="stats-grid">
            <div class="stat-card">
                <div class="number" id="uniqueAccounts">0</div>
                <div class="label">unique accounts</div>
            </div>
            <div class="stat-card">
                <div class="number" id="totalCards">0</div>
                <div class="label">total cards</div>
            </div>
        </div>

        <div class="controls">
            <div class="filter-group">
                <button class="btn" id="loadCSVBtn" onclick="document.getElementById('fileInput').click()">load csv</button>
                <input type="file" id="fileInput" accept=".csv">

                <input type="text" id="searchInput" placeholder="search account..." disabled>

                <select id="packFilter" disabled>
                    <option value="">all packs</option>
                </select>

                <select id="cardFilter" disabled>
                    <option value="">all cards</option>
                </select>
                
                <button class="btn export-btn" onclick="exportFiltered()" id="exportBtn" disabled>export</button>
            </div>
        </div>

        <div class="table-container">
            <table id="mainTable">
                <thead id="tableHead">
                    <tr>
                        <th class="col-account"><span data-i18n="deviceAccount">deviceAccount</span></th>
                        <th class="col-pack"><span data-i18n="pack">pack</span></th>
                        <th class="col-cards"><span data-i18n="cards">cards</span></th>
                        <th class="col-shinedust"><span data-i18n="shinedust">shinedust</span></th>
                        <th class="col-screenshot"><span data-i18n="screenshot">screenshot</span></th>
                        <th class="col-xml"><span data-i18n="xml">.xml</span></th>
                        <th class="col-subTime"><span data-i18n="date">date</span></th>
                    </tr>
                </thead>
                <tbody id="tableBody">
                    <tr>
                        <td colspan="7" class="empty-state">
                            <h2>no data loaded</h2>
                            <p>click load csv to view database</p>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>
</body>
</html>
